<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:jsf="http://xmlns.jcp.org/jsf"
	template="/templates/template.xhtml">

	<ui:define name="metadata">
		<f:metadata>
			<f:viewAction action="#{companyMaintenanceMB.load()}" />
		</f:metadata>
	</ui:define>

	<ui:define name="content">

		<!-- Divs principales que casi siempre iran en un page -->
		<div id="main-content">
			<div class="container">
				<div class="row">
					<div id="content" class="col-lg-12">
						<!-- /Divs principales que casi siempre iran en un page -->

						<!-- PAGE HEADER-->
						<div class="row">
							<div class="col-sm-12">
								<div class="page-header">
									<div class="clearfix">
										<h3 class="content-title pull-left">#{i18n['companyMaintenance.label.title']}</h3>
									</div>
									<div class="description">#{i18n['companyMaintenance.label.subtitle']}</div>
								</div>
							</div>
						</div>
						<!-- /PAGE HEADER -->

						<!-- PAGE BODY -->

						<!--  Filtros de busqueda y boton nuevo -->
						<h:panelGroup id="pnlUserListFilters" layout="block">

							<div class="row">
								<div class="col-md-12">
									<div class="box-body">
										<h:form class="form-horizontal" prependId="false">
											<table>
												<tr>
													<td>
														<div class="col-md-12">
															<button
																jsf:outcome="/pages/secured/maintenances/companyEdit"
																class="btn btn-primary">
																<i class="fa fa-plus"></i><span class="menu-text">
																	#{i18n['companyMaintenance.button.register']}</span>
															</button>
														</div>
													</td>
												</tr>
											</table>
										</h:form>
									</div>
								</div>
							</div>
						</h:panelGroup>
						<!--  /Filtros de busqueda y boton nuevo -->

						<div class="separator"></div>

						<!-- Tabla de datos -->
						<div class="row">
							<div class="col-md-12">
								<!-- BOX -->
								<div class="box border purple">
									<div class="box-title">
										<h4>
											<i class="fa fa-table"></i>#{i18n['companyMaintenance.label.title']}
										</h4>
										<div class="tools hidden-xs">
											<a href="javascript:;" class="reload"> <i
												class="fa fa-refresh"></i>
											</a> <a href="javascript:;" class="collapse"> <i
												class="fa fa-chevron-up"></i>
											</a> <a href="javascript:;" class="remove"> <i
												class="fa fa-times"></i>
											</a>
										</div>
									</div>
									<div class="box-body">

										<h:panelGroup rendered="#{empty companiesList}">
											<div class="alert alert-block alert-danger fade in">
												<h:outputText
													value="#{i18n['companyMaintenance.label.listEmpty']}" />
											</div>
										</h:panelGroup>

										<h:dataTable id="datatable2" value="#{companiesList}"
											var="company"
											styleClass="datatable table table-striped table-bordered table-hover"
											columnClasses="none,none,none,none,none,none,none"
											rendered="#{not empty companiesList}">
											<h:column>
												<f:facet name="header">#{i18n['companyMaintenance.column.ruc']}</f:facet>
												<h:outputText value="#{company.ruc}" />
												<f:facet name="footer">#{i18n['companyMaintenance.column.ruc']}</f:facet>
											</h:column>
											<h:column>
												<f:facet name="header">#{i18n['companyMaintenance.column.razonSocial']}</f:facet>
												<h:outputText value="#{company.razonSocial}" />
												<f:facet name="footer">#{i18n['companyMaintenance.column.razonSocial']}</f:facet>
											</h:column>
											<h:column>
												<f:facet name="header">#{i18n['companyMaintenance.column.address']}</f:facet>
												<h:outputText value="#{company.address}" />
												<f:facet name="footer">#{i18n['companyMaintenance.column.address']}</f:facet>
											</h:column>
											<h:column>
												<f:facet name="header">#{i18n['companyMaintenance.column.mobilePhone']}</f:facet>
												<h:outputText value="#{company.mobilePhone}" />
												<f:facet name="footer">#{i18n['companyMaintenance.column.homePhone']}</f:facet>
											</h:column>
											<h:column>
												<f:facet name="header">#{i18n['companyMaintenance.column.webPage']}</f:facet>
												<h:outputText value="#{company.webPage}" />
												<f:facet name="footer">#{i18n['companyMaintenance.column.webPage']}</f:facet>
											</h:column>
											<h:column>
												<f:facet name="header">Empleados</f:facet>
												<h:commandButton id="btnShowModalEmployees"
														action="#{companyMaintenanceMB.findEmployeesDetailReport(company)}"
														class="btn btn-xs btn-info"  data-toggle="modal" value="(#{company.nroEmpleados})">
														<f:ajax execute="@form" render=":panelEmployee"
															onevent="function(data) { showModalEmployees(data) }" />
												</h:commandButton>
												<f:facet name="footer">Empleados</f:facet>
											</h:column>
											<h:column>
												<f:facet name="header">#{i18n['companyMaintenance.column.homePhone']}</f:facet>
												<h:outputText value="#{company.homePhone}" />
												<f:facet name="footer">#{i18n['companyMaintenance.column.homePhone']}</f:facet>
											</h:column>
											<h:column>
												<f:facet name="header">#{i18n['companyMaintenance.column.status']}</f:facet>
												<h:outputText
													value="#{company.status == 1 ? i18n['companyMaintenance.label.active'] : i18n['companyMaintenance.label.inactive']}" />
												<f:facet name="footer">#{i18n['companyMaintenance.column.status']}</f:facet>
											</h:column>
											<h:column>
												<f:facet name="header">#{i18n['companyMaintenance.column.edit']}</f:facet>
												<button class="btn btn-xs btn-info"
													title="Editar #{company.razonSocial}"
													jsf:outcome="/pages/secured/maintenances/companyEdit">
													<i class="fa fa-pencil-square-o"></i>
													<f:param name="ruc" value="#{company.ruc}" />
												</button>
												<f:facet name="footer">#{i18n['companyMaintenance.column.edit']}</f:facet>
											</h:column>
										</h:dataTable>
									</div>
								</div>
								<!-- /BOX -->
							</div>
						</div>
						<!-- /Tabla de datos -->
						
						
						<!-- SAMPLE BOX CONFIGURATION MODAL FORM-->
						<h:panelGroup id="panelEmployee">
							<div class="modal fade" id="table-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
								<div class="modal-dialog">
									<div class="modal-content modal-table">
																											
										<div class="modal-header"  >
											<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
											<h4 class="modal-title">Detalle de Empleados de #{companyByRUC.razonSocial}</h4>
										</div>
	
										<div class="modal-body">
											 
											 <h:dataTable styleClass="table table-bordered table-hover"
											 	value="#{listEmployeeByRUC}" var="detail">
												<h:column>
													<f:facet name="header">ID</f:facet>
													#{detail.employeeId}
												</h:column>
												<h:column>
													<f:facet name="header">Nombres</f:facet>
													#{detail.firstName}
												</h:column>
												<h:column>
													<f:facet name="header">Apellidos</f:facet>
													#{detail.lastName}
												</h:column>
												<h:column>
													<f:facet name="header">Email</f:facet>
													#{detail.email}
												</h:column>
												<h:column>
													<f:facet name="header">Cargo</f:facet>
													#{detail.cargo.name}
												</h:column>
											</h:dataTable>
											
										</div>
										<div class="modal-footer">
											<button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
										</div>

									</div>
								</div>
							</div>
						</h:panelGroup>				
						<!-- /SAMPLE BOX CONFIGURATION MODAL FORM-->
						
						
						<div class="footer-tools">
							<span class="go-top"> <i class="fa fa-chevron-up"></i> Top
							</span>
						</div>
						<!-- /PAGE BODY -->
					</div>
				</div>
			</div>
		</div>
	</ui:define>

	<ui:define name="js">
		<!-- JQUERY -->
		<h:outputScript library="libs/cloud-admin/js/jquery"
			name="jquery-2.0.3.min.js" />
		<!-- JQUERY UI-->
		<h:outputScript
			library="libs/cloud-admin/js/jquery-ui-1.10.3.custom/js"
			name="jquery-ui-1.10.3.custom.min.js" />
		<!-- BOOTSTRAP -->
		<h:outputScript library="libs/bootstrap-dist/js"
			name="bootstrap.min.js" />
		<!-- DATE RANGE PICKER -->
		<h:outputScript
			library="libs/cloud-admin/js/bootstrap-daterangepicker"
			name="moment.min.js" />
		<h:outputScript
			library="libs/cloud-admin/js/bootstrap-daterangepicker"
			name="daterangepicker.min.js" />
		<!-- SLIMSCROLL -->
		<h:outputScript library="libs/cloud-admin/js/jQuery-slimScroll-1.3.0"
			name="jquery.slimscroll.min.js" />
		<h:outputScript library="libs/cloud-admin/js/jQuery-slimScroll-1.3.0"
			name="slimScrollHorizontal.min.js" />
		<!-- BLOCK UI -->
		<h:outputScript library="libs/cloud-admin/js/jQuery-BlockUI"
			name="jquery.blockUI.min.js" />
		<!-- BOOTSTRAP SWITCH -->
		<h:outputScript library="libs/cloud-admin/js/bootstrap-switch"
			name="bootstrap-switch.min.js" />
		<!-- BOOTBOX -->
		<h:outputScript library="libs/cloud-admin/js/bootbox"
			name="bootbox.min.js" />
		<!-- DATE PICKER -->
		<h:outputScript library="libs/cloud-admin/js/datepicker"
			name="picker.js" />
		<h:outputScript library="libs/cloud-admin/js/datepicker"
			name="picker.date.js" />
		<h:outputScript library="libs/cloud-admin/js/datepicker"
			name="picker.time.js" />
		<!-- MAGIC SUGGEST -->
		<h:outputScript library="libs/cloud-admin/js/magic-suggest"
			name="magicsuggest-1.3.1-min.js" />
		<!-- DATA TABLES -->
		<h:outputScript library="libs/cloud-admin/js/datatables/media/js"
			name="jquery.dataTables.min.js" />
		<h:outputScript
			library="libs/cloud-admin/js/datatables/media/assets/js"
			name="datatables.min.js" />

		<!-- ESTE JS GENERA REPETIDAS LLAMADAS AL CONTROLLER -->
		<!-- 		<h:outputScript -->
		<!-- 			library="libs/cloud-admin/js/datatables/extras/TableTools/media/js/" -->
		<!-- 			name="TableTools.min.js" /> -->

		<h:outputScript
			library="libs/cloud-admin/js/datatables/extras/TableTools/media/js"
			name="ZeroClipboard.min.js" />
		<!-- COOKIE  -->
		<h:outputScript library="libs/cloud-admin/js/jQuery-Cookie"
			name="jquery.cookie.min.js" />

		<!-- CUSTOM SCRIPT -->
		<h:outputScript library="libs/cloud-admin/js" name="script.js" />

		<script>
			function showModalEmployees(e){
				if(e.status == 'begin'){					
				}
				if(e.status == 'success'){					
					//showModalJquery();
					jQuery('#table-modal').modal('show');  
				}
			}
		
			<!-- Establecer estilo activo al menu seleccionado -->
			jQuery(document).ready(function() {					
				document.getElementById('menuMaintenances').className += " active";
				document.getElementById('menuCompanyMaintenance').className = "current";	
			});	
				
			jQuery(document).ready(function() {
				App.setPage("dynamic_table"); //Set current page
				App.init(); //Initialise plugins and elements
			});
			jQuery(document).ready(function() {		
				App.setPage("elements");  //Set current page
				App.init(); //Initialise plugins and elements
			});		
			jQuery(document).ready(function() {		
				App.setPage("forms");  //Set current page
				App.init(); //Initialise plugins and elements
			});	
		</script>


	</ui:define>

</ui:composition>
