<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:jsf="http://xmlns.jcp.org/jsf"
	template="/templates/template.xhtml">

	<ui:define name="metadata">
		<f:metadata>
			<f:viewParam name="eventId" value="#{eventsAssignMB.evento.eventId}" />
		</f:metadata>
	</ui:define>

	<ui:define name="content">

		<!-- Divs principales que casi siempre iran en un page -->
		<div id="main-content">
			<div class="container">
				<div class="row">
					<div id="content" class="col-lg-12">
						<!-- /Divs principales que casi siempre iran en un page -->

						<!-- PAGE HEADER-->
						<div class="row">
							<div class="col-sm-12">
								<div class="page-header">
									<div class="clearfix">
										<h3 class="content-title pull-left">Sub Evento</h3>
									</div>
								</div>
							</div>
						</div>

						<h:form id="frmModal" prependId="false">

							<h:panelGroup
								rendered="#{not facesContext.validationFailed and not empty facesContext.messageList}">
								<div class="alert alert-block alert-danger fade in">
									<a class="close" data-dismiss="alert" href="#"
										aria-hidden="true">×</a>
									<h:messages globalOnly="true" showDetail="true" />
								</div>
							</h:panelGroup>

							<h:inputHidden id="hiddenSubEventId"
								value="#{eventsAssignMB.subEvento.subEventId}" />


							<h:commandButton id="btnShowModalSubEventToRegister"
								action="#{eventsAssignMB.showModalSubEventToRegister()}"
								style="display: none;">
								<f:ajax execute="@form" render="@form"
									onevent="function(data) { showModalSubEvent(data) }" />
							</h:commandButton>

							<h:commandButton id="btnShowModalSubEventToUpdate"
								action="#{eventsAssignMB.showModalSubEventToUpdate()}"
								style="display: none;">
								<f:ajax execute="@form" render="@form"
									onevent="function(data) { showModalSubEvent(data) }" />
							</h:commandButton>

							<div class="modal fade" id="modalSubEvent" tabindex="-1"
								role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
								<div class="modal-dialog">
									<div class="modal-content">

										<div class="modal-header">
											<button type="button" class="close" data-dismiss="modal"
												aria-hidden="true">X</button>
											<h4 class="modal-title" id="myModalLabel">Edición de
												#{eventsAssignMB.subEvento.evento.name} -
												#{eventsAssignMB.subEvento.curso.name}</h4>
										</div>

										<div class="modal-body">
											<div class="row">
												<label class="col-sm-2 control-label">Evento</label>
												<div class="col-sm-4">
													<h:outputText styleClass="form-control"
														value="#{eventsAssignMB.subEvento.evento.name}" />
												</div>
											</div>
											<br />

											<div class="row">
												<label class="col-sm-2 control-label">Curso</label>
												<div class="col-sm-4">

													<select id="e3" required="required" size="1"
														jsf:value="#{eventsAssignMB.subEvento.curso.courseId}">
														<option jsfc="f:selectItem" itemValue="#{null}"
															itemLabel="Seleccione Curso" />
														<ui:repeat value="#{eventsAssignMB.coursesList}"
															var="course" jsfc="f:selectItems"
															itemValue="#{course.courseId}" itemLabel="#{course.name}" />
													</select>
												</div>
												<label class="col-sm-2 control-label">Capacitador</label>
												<div class="col-sm-4">
													<select id="cboCapacitador" required="required" size="1"
														jsf:value="#{eventsAssignMB.subEvento.capacitador.capacitadorId}">
														<option jsfc="f:selectItem" itemValue="#{null}"
															itemLabel="Seleccione Capacitador" />
														<ui:repeat value="#{eventsAssignMB.trainersList}"
															var="trainer" jsfc="f:selectItems"
															itemValue="#{trainer.capacitadorId}"
															itemLabel="#{trainer.firstName}#{trainer.lastName}" />
													</select>
												</div>
											</div>
											<br />

											<div class="row">
												<label class="col-sm-2 control-label">Fecha Inicio</label>
												<div class="col-sm-4">
													<input type="text" maxlength="45" class="form-control"
														placeholder="#{i18n['eventEdit.placeholder.enterName']}"
														jsf:value="#{eventsAssignMB.subEvento.dateStart}"
														required="required" />
												</div>
												<label class="col-sm-2 control-label">Fecha Fin</label>
												<div class="col-sm-4">
													<input type="text" maxlength="45" class="form-control"
														placeholder="#{i18n['eventEdit.placeholder.enterName']}"
														jsf:value="#{eventsAssignMB.subEvento.dateEnd}"
														required="required" />
												</div>
											</div>
										</div>

										<div class="modal-footer">
											<button type="button" class="btn btn-default"
												data-dismiss="modal">Close</button>
											<button jsf:action="#{eventsAssignMB.editSubEvent()}"
												type="button" class="btn btn-primary">
												Guardar Cambios
												<f:ajax execute="@form" render="@all" />
											</button>
										</div>
									</div>
								</div>
							</div>
						</h:form>

						<!-- /PAGE HEADER -->

						<!-- CALENDAR -->
						<div class="row">
							<div class="col-md-12">
								<!-- BOX -->
								<div class="box border">
									<div class="box-title">
										<h4>
											<i class="fa fa-calendar"></i>Calendar
										</h4>
										<div class="tools">
											<a href="javascript:;" class="reload"> <i
												class="fa fa-refresh"></i>
											</a> <a href="javascript:;" class="collapse"> <i
												class="fa fa-chevron-up"></i>
											</a> <a href="javascript:;" class="remove"> <i
												class="fa fa-times"></i>
											</a>
										</div>
									</div>
									<div class="box-body">
										<div class="row">
											<div class="col-md-9">
												<div id='calendarSubEvents'></div>
											</div>
										</div>
									</div>
								</div>
								<!-- /BOX -->
							</div>
						</div>
						<!-- /CALENDAR -->

					</div>
				</div>
			</div>
		</div>
	</ui:define>
	<ui:define name="js">
		<!-- JQUERY -->
		<h:outputScript library="libs/cloud-admin/js/jquery"
			name="jquery-2.0.3.min.js" />

		<!-- JQUERY UI-->
		<h:outputScript
			library="libs/cloud-admin/js/jquery-ui-1.10.3.custom/js"
			name="jquery-ui-1.10.3.custom.min.js" />

		<!-- BOOTSTRAP -->
		<h:outputScript library="libs/bootstrap-dist/js"
			name="bootstrap.min.js" />

		<!-- FULL CALENDAR -->
		<h:outputScript library="libs/cloud-admin/js/fullcalendar"
			name="fullcalendar.min.js" />

		<!-- BOOTBOX (MODAL) -->
		<h:outputScript library="libs/cloud-admin/js/bootbox"
			name="bootbox.min.js" />

		<!-- DATE RANGE PICKER -->
		<h:outputScript
			library="libs/cloud-admin/js/bootstrap-daterangepicker"
			name="moment.min.js" />
		<h:outputScript
			library="libs/cloud-admin/js/bootstrap-daterangepicker"
			name="daterangepicker.min.js" />

		<!-- SLIMSCROLL -->
		<h:outputScript library="libs/cloud-admin/js/jQuery-slimScroll-1.3.0"
			name="jquery.slimscroll.min.js" />
		<h:outputScript library="libs/cloud-admin/js/jQuery-slimScroll-1.3.0"
			name="slimScrollHorizontal.min.js" />

		<!-- BLOCK UI -->
		<h:outputScript library="libs/cloud-admin/js/jQuery-BlockUI"
			name="jquery.blockUI.min.js" />

		<!-- TYPEHEAD -->
		<h:outputScript library="libs/cloud-admin/js/typeahead"
			name="typeahead.min.js" />

		<!-- AUTOSIZE -->
		<h:outputScript library="libs/cloud-admin/js/autosize"
			name="jquery.autosize.min.js" />

		<!-- COUNTABLE -->
		<h:outputScript library="libs/cloud-admin/js/countable"
			name="jquery.simplyCountable.min.js" />

		<!-- INPUT MASK -->
		<h:outputScript library="libs/cloud-admin/js/bootstrap-inputmask"
			name="bootstrap-inputmask.min.js" />

		<!-- SELECT2 -->
		<h:outputScript library="libs/cloud-admin/js/select2"
			name="select2.min.js" />

		<!-- UNIFORM -->
		<h:outputScript library="libs/cloud-admin/js/uniform"
			name="jquery.uniform.min.js" />

		<!-- COOKIE  -->
		<h:outputScript library="libs/cloud-admin/js/jQuery-Cookie"
			name="jquery.cookie.min.js" />

		<!-- DATE PICKER -->
		<h:outputScript library="libs/cloud-admin/js/datepicker"
			name="picker.js" />
		<h:outputScript library="libs/cloud-admin/js/datepicker"
			name="picker.date.js" />
		<h:outputScript library="libs/cloud-admin/js/datepicker"
			name="picker.time.js" />

		<!-- MAGIC SUGGEST -->
		<h:outputScript library="libs/cloud-admin/js/magic-suggest"
			name="magicsuggest-1.3.1-min.js" />

		<!-- CUSTOM SCRIPT -->
		<h:outputScript library="libs/cloud-admin/js" name="script.js" />

		<script>			
		
			function showModalSubEvent(e){
				if(e.status == 'begin'){					
				}
				if(e.status == 'success'){					
					//showModalJquery();
					jQuery('#modalSubEvent').modal('show');  
				}
			}
			
			jQuery(document).ready(function () {    			

				// Calendar
                jQuery('#calendarSubEvents').fullCalendar({
                	header: {
        				left: 'prevYear,prev,next,nextYear today',
        				center: 'title',
        				right: 'month,agendaWeek,agendaDay'
        			},
        			firstDay:1, // Primer dia: Lunes
					editable: false, // Eventos pueden ser modificados(dragged, resized)
                    events : #{eventsAssignMB.getSubEventsByEventId()},
                    
                    // Al dar clic en un dia cualquiera para registrar un subEvento
                    dayClick: function(date, allDay, jsEvent, view) {
//                     	var selDate = jQuery.fullCalendar.formatDate(date,'yyyy-MM-dd');        	
//                     	alert('Clicked on: ' + selDate);
						// change the day's background color just for fun
				        //$(this).css('background-color', 'red');

						// Mostrar modal 
                    	// jQuery('#modalSubEvent').modal('show'); // se mostro estilo de combo
                    	document.getElementById("btnShowModalSubEventToRegister").click();
				        				                       	               	
                    },
                    
                    // Al dar clic en un subEvento para editarlo
                    eventClick: function(calEvent, jsEvent, view) {
						jQuery("#hiddenSubEventId").val(calEvent.id);
                        document.getElementById("btnShowModalSubEventToUpdate").click();
                    },
                });		

             });

			jQuery(document).ready(function() {		
				<!-- Establecer estilo activo al menu seleccionado -->    				
   				document.getElementById('menuProcesses').className += " active";
   				document.getElementById('menuEventsAssignProcess').className = "current";

   				App.setPage("forms");  //Set current page
				App.init(); //Initialise plugins and elements
			});
		</script>


	</ui:define>

</ui:composition>
